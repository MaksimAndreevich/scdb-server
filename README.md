# SCDB Server

Серверная часть системы управления образовательными организациями (SCDB - School Control Database).

## Описание

SCDB Server - это REST API сервер, предоставляющий доступ к базе данных образовательных организаций. Сервер реализован на Go с использованием Gin framework и PostgreSQL в качестве базы данных.

## Основные возможности

- Получение информации об образовательных организациях
- Поиск организаций с фильтрацией и пагинацией
- Получение статистики по базам данных
- Поддержка различных типов образовательных учреждений

## Технический стек

- Go 1.24.3
- Gin Web Framework
- PostgreSQL 17.4
- Docker & Docker Compose

## Требования

- Go 1.24.3 или выше
- Docker и Docker Compose
- PostgreSQL 17.4 (если запуск без Docker)

## Установка и запуск

### Использование Docker

1. Клонируйте репозиторий:

```bash
git clone https://gitlab.com/scdb/server.git
cd server
```

2. Запустите приложение с помощью Docker Compose:

```bash
docker-compose up -d
```

Сервер будет доступен по адресу: http://localhost:8080

### Локальная установка

1. Установите зависимости:

```bash
go mod download
```

2. Создайте файл .env в корневой директории:

```env
DB_HOST=localhost
DB_PORT=5432
DB_USER=user
DB_PASSWORD=password
DB_NAME=db
```

3. Запустите сервер:

```bash
go run main.go
```

## API Endpoints

### Организации

- `GET /api/organizations/{id}` - Получение организации по ID
- `GET /api/organizations` - Получение списка организаций с пагинацией и фильтрацией
  - Параметры:
    - search - Поисковый запрос
    - federal_district_id - ID федерального округа
    - region_id - ID региона
    - city_id - ID города
    - education_type_key - Тип образования
    - page - Номер страницы
    - per_page - Количество записей на странице

### Статистика

- `GET /api/stats` - Получение общей статистики по базам данных

## Разработка

### Структура проекта

```
.
├── docs/                    # Документация
├── internal/               # Внутренний код приложения
│   ├── config/            # Конфигурация
│   ├── database/          # Работа с базой данных
│   └── routers/           # Маршрутизация
├── main.go                # Точка входа
├── Dockerfile             # Конфигурация Docker
├── docker-compose.yml     # Конфигурация Docker Compose
└── go.mod                 # Зависимости Go
```

### Hot Reload

Для разработки используется Air для автоматической перезагрузки при изменении кода:

```bash
air
```

### Как создать DEMO образ?

1. Создаем демо-образ

```bash
docker-compose -f docker-compose.demo.yml up -d
```

2. Наполняем DB данными использую при этом сервис [UPDATER](https://gitlab.com/scdb/updater)

3. Подключаемся к db и вручную выполнсяем ОБФУСКАЦИЮ данных с помощью скрипта sql database/obfuscate_database.sql

4. Создаем образ server с данными

```bash
docker commit scdb-server-demo scdb-server-demo:v1.0
```

5. Сохраняем образ server в файл

```bash
docker save scdb-server-demo:v1.0 | gzip > ../demo/scdb-server-demo.tar.gz
```

6. Создаем дамп базы данных и сохраняем в ../demo/ (контейнер должен быть запущен)

````bash
docker exec scdb-postgres-demo pg_dump -U postgres -d db > ../demo/demo-database-dump.sql
```

## Роадмап

### 1. Безопасность и Авторизация (Высокий приоритет)

- [ ] Базовая защита базы данных(запрет на записть, кроме разрешенных ip)
- [ ] Система API-ключей
  - Генерация уникальных ключей
  - Хранение в базе данных
  - Ограничение по IP
  - Лимиты запросов
- [ ] Демо-режим
  - Ограниченный набор данных
  - Ограниченный функционал
  - Временный доступ
- [ ] Middleware для проверки API-ключей
- [ ] Система логирования доступа
- [ ] Блокировка при подозрительной активности

### 2. Оптимизация производительности

- [ ] Кеширование часто запрашиваемых данных
- [ ] Оптимизация SQL-запросов
- [ ] Мониторинг производительности

### 3. Расширение функционала API

- [ ] Экспорт данных (CSV, Excel, PDF)
- [ ] Импорт данных (cli для удобного ипорта или админка на фронте - что дольше и сложнее)
- [ ] Статистика и аналитика (сколько запросов обработано и тд)

### 4. Масштабирование

- [ ] Контейнеризация (оптимизировать что то?)
- [ ] CI/CD пайплайн

### 5. Тестирование

- [ ] Unit тесты
- [ ] Интеграционные тесты
- [ ] Нагрузочное тестирование
- [ ] Тестирование безопасности
````
